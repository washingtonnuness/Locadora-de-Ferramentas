{% extends 'base.html'%}
{% load static %}
{% load widget_tweaks %}
{% block produto_form %}

    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4 mt-2">
        <h2>{{title}}</h2>
        <div class="container-fluid">
            <form method="POST">
                {% csrf_token %}
                <div class="form-row">
                    <div class="form-group col-sm">
                        <label>CÃ³digo</label>
                        {% render_field form.codigo class="form-control" %}
                    </div>
                    <div class="form-group col-sm">
                        <label>{{form.id_grupo.label}}</label>
                        {% render_field form.id_grupo class="form-control" %}
                    </div>
                    <div class="form-group col-sm">
                        <label>{{form.id_marca.label}}</label>
                        {% render_field form.id_marca class="form-control" %}
                    </div>
                    <div class="form-group col-md-12">
                        <label>{{form.nome.label}}</label>
                        {% render_field form.nome class="form-control" %}
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md">
                        <label>{{form.valor_Compra.label}}</label>
                        {% render_field form.valor_Compra class="form-control" %}
                    </div>
                    <div class="form-group col-md">
                        <label>{{form.valor_Locacao.label}}</label>
                        {% render_field form.valor_Locacao class="form-control" %}
                    </div>
                    <div class="form-group col-md">
                        <label>{{form.estoque_minimo.label}}</label>
                        {% render_field form.estoque_minimo class="form-control" %}
                    </div>
                    <div class="form-group col-md">
                        <label for="inputAddress">Quantidade Estoque</label>
                        {% render_field form.qnt_estoque class="form-control" %}
                    </div>
                    <div class="form-group col-md">
                        <label for="inputAddress">Quantidade Total</label>
                        {% render_field form.estoque_total class="form-control" %}
                    </div>
                </div>

                <div class="form-group">
                    <div class="form-check">
                        {% render_field form.checkbox class='form-check-input' type='checkbox' %}
                        <label class="form-check-label" for="gridCheck">
                            Desativar
                        </label>
                    </div>
                </div>

                {{ formset.management_form }}
                <div class="row">
                    <div class="col-sm-12">
    
                        <legend class="legend">Patrimonio</legend>
                        <div class="row">
                            <button class='btn btn-primary mb-2' id="add-item" type="button">Adicionar</button>
                        </div>
                        <div id="order" class="form-inline">
                            {% for item_order_form in formset %}
                            <div class="form-group">
                                <div id="item-{{ forloop.counter0 }}">
                                </div>
                            </div>
                            {% endfor %}
                        </div>
    
                    </div>
                </div>    

                <div class="row  mt-4">
                    <button class='btn btn-primary' type="submit">Salvar</button>
                    <button type="button" class="btn btn-danger">Cancelar</button>
                </div>

            </form>
        </div>
    </div>
    </main>
{% endblock produto_form %}


{% block scripts %}
<!-- TESTE -->
<script type="text/html" id="item-order">
    <div id="item-__prefix__">
        {{ formset.empty_form.patrimonio}}
    </div>
</script>
<script>

    $(document).ready(function(){
        $("#add-item").click(function(ev) {
            ev.preventDefault();
            var count = $('#order').children().length;
            var tmplMarkup = $("#item-order").html();
            var compiledTmpl = tmplMarkup.replace(/__prefix__/g, count);
            $("div#order").append(compiledTmpl);

            // update form count
            $('#id_patrimonios-TOTAL_FORMS').attr('value', count + 1);

            // some animate to scroll to view our new form
            $('html, body').animate({
                scrollTop: $("#add-item").position().top-200
            }, 800);
        });
    });
</script>
{% endblock scripts %}